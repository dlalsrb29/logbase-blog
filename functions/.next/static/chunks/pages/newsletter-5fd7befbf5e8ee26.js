(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{4875:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/newsletter",function(){return t(2330)}])},2330:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return l}});var i=t(5893),r=t(1822),a=t.n(r),d=t(7294),n=t(1664),o=t.n(n);function l(){let[e,s]=(0,d.useState)([]),[t,r]=(0,d.useState)(!0),[n,l]=(0,d.useState)(!1),[b,c]=(0,d.useState)(null),[x,p]=(0,d.useState)({subject:"",fromName:"",fromEmail:"",recipients:[]}),[f,m]=(0,d.useState)([]),[j,h]=(0,d.useState)(!1),[g,u]=(0,d.useState)(!1);(0,d.useEffect)(()=>{w()},[]);let w=async()=>{try{let e=await fetch("/api/newsletter-list");if(e.ok){let t=await e.json();s(t.newsletters||[])}}catch(e){console.error("뉴스레터 목록을 불러오는데 실패했습니다:",e)}finally{r(!1)}},y=async()=>{h(!0);try{let e=await fetch("/api/newsletter-recipients");if(e.ok){let s=await e.json();m(s.recipients||[])}else console.error("수신자 목록을 불러오지 못했습니다.")}catch(e){console.error("수신자 목록 로드 오류:",e)}finally{h(!1)}},k=async e=>{c(e),p({subject:e.title,fromName:"LogBase Newsletter",fromEmail:"haesu.hwang@logbase.kr",recipients:e.recipients||[]}),l(!0),await y()},N=e=>{let{name:s,value:t}=e.target;p(e=>({...e,[s]:t}))},v=(e,s)=>{s?p(s=>({...s,recipients:[...s.recipients,e]})):p(s=>({...s,recipients:s.recipients.filter(s=>s.id!==e.id)}))},z=e=>{e?p(e=>({...e,recipients:[...f]})):p(e=>({...e,recipients:[]}))},S=async e=>{if(e.preventDefault(),b){if(!x.subject.trim()||!x.fromName.trim()||!x.fromEmail.trim()){alert("제목, 발신자명, 발신자 이메일은 필수 항목입니다.");return}if(0===x.recipients.length){alert("수신자를 한 명 이상 선택해주세요.");return}if(confirm("".concat(x.recipients.length,"명에게 뉴스레터를 발송하시겠습니까?"))){u(!0);try{let e=await fetch("/api/newsletter-send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:b.filename,subject:x.subject,fromName:x.fromName,fromEmail:x.fromEmail,recipients:x.recipients})}),s=await e.json();if(e.ok)alert("뉴스레터가 성공적으로 발송되었습니다!"),l(!1);else throw Error(s.message||"발송에 실패했습니다.")}catch(s){let e=s instanceof Error?s.message:String(s);alert("발송 오류: ".concat(e))}finally{u(!1)}}}},C=async e=>{if(confirm("'".concat(e,"' 뉴스레터를 정말 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.")))try{let s=await fetch("/api/newsletter-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:e})}),t=await s.json();if(s.ok)alert(t.message),await w();else throw Error(t.message||"삭제 중 오류가 발생했습니다.")}catch(s){let e=s instanceof Error?s.message:String(s);alert("오류: ".concat(e))}};return t?(0,i.jsx)("div",{className:"container",children:(0,i.jsx)("div",{className:"loading",children:"뉴스레터 목록을 불러오는 중..."})}):(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 container",children:[(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 header",children:[(0,i.jsx)("h1",{className:"jsx-96fdb18659252259",children:"뉴스레터 목록"}),(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 header-buttons",children:[(0,i.jsx)("button",{type:"button",onClick:()=>window.location.href="/newsletter/subscribers",className:"jsx-96fdb18659252259 btn-subscribers",children:"신청자 관리"}),(0,i.jsx)("button",{type:"button",onClick:()=>window.location.href="/newsletter/write",className:"jsx-96fdb18659252259 btn-new",children:"새 뉴스레터 작성"})]})]}),(0,i.jsxs)("table",{className:"jsx-96fdb18659252259",children:[(0,i.jsx)("thead",{className:"jsx-96fdb18659252259",children:(0,i.jsxs)("tr",{className:"jsx-96fdb18659252259",children:[(0,i.jsx)("th",{className:"jsx-96fdb18659252259",children:"제목"}),(0,i.jsx)("th",{className:"jsx-96fdb18659252259",children:"발송일"}),(0,i.jsx)("th",{style:{textAlign:"center"},className:"jsx-96fdb18659252259",children:"액션"})]})}),(0,i.jsx)("tbody",{className:"jsx-96fdb18659252259",children:e.length>0?e.map((e,s)=>(0,i.jsxs)("tr",{className:"jsx-96fdb18659252259",children:[(0,i.jsx)("td",{className:"jsx-96fdb18659252259",children:e.title}),(0,i.jsx)("td",{className:"jsx-96fdb18659252259",children:new Date(e.sentDate).toLocaleDateString("ko-KR")}),(0,i.jsxs)("td",{className:"jsx-96fdb18659252259 actions",children:[(0,i.jsx)("button",{type:"button",onClick:()=>window.open(e.htmlFilePath,"_blank"),title:"새 창에서 미리보기",className:"jsx-96fdb18659252259 btn-preview",children:"미리보기"}),(0,i.jsx)("button",{type:"button",onClick:()=>k(e),title:"이메일 발송",className:"jsx-96fdb18659252259 btn-send",children:"\uD83D\uDCE7 발송"}),(0,i.jsx)(o(),{href:"/newsletter/edit/".concat(encodeURIComponent(e.filename)),children:(0,i.jsx)("button",{type:"button",className:"jsx-96fdb18659252259 btn-edit",children:"편집"})}),(0,i.jsx)("button",{type:"button",onClick:()=>C(e.filename),className:"jsx-96fdb18659252259 btn-delete",children:"삭제"})]})]},s)):(0,i.jsx)("tr",{className:"jsx-96fdb18659252259",children:(0,i.jsx)("td",{colSpan:3,style:{textAlign:"center"},className:"jsx-96fdb18659252259",children:"뉴스레터가 없습니다."})})})]}),n&&b&&(0,i.jsx)("div",{className:"jsx-96fdb18659252259 modal-overlay",children:(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 modal",children:[(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 modal-header",children:[(0,i.jsx)("h3",{className:"jsx-96fdb18659252259",children:"뉴스레터 발송"}),(0,i.jsx)("button",{type:"button",onClick:()=>l(!1),disabled:g,className:"jsx-96fdb18659252259 btn-close",children:"\xd7"})]}),(0,i.jsxs)("form",{onSubmit:S,className:"jsx-96fdb18659252259",children:[(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 modal-body",children:[(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 form-group",children:[(0,i.jsx)("label",{htmlFor:"subject",className:"jsx-96fdb18659252259",children:"이메일 제목"}),(0,i.jsx)("input",{type:"text",id:"subject",name:"subject",value:x.subject,onChange:N,required:!0,disabled:g,className:"jsx-96fdb18659252259"})]}),(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 form-row",children:[(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 form-group",children:[(0,i.jsx)("label",{htmlFor:"fromName",className:"jsx-96fdb18659252259",children:"발신자명"}),(0,i.jsx)("input",{type:"text",id:"fromName",name:"fromName",value:x.fromName,onChange:N,required:!0,disabled:g,className:"jsx-96fdb18659252259"})]}),(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 form-group",children:[(0,i.jsx)("label",{htmlFor:"fromEmail",className:"jsx-96fdb18659252259",children:"발신자 이메일"}),(0,i.jsx)("input",{type:"email",id:"fromEmail",name:"fromEmail",value:x.fromEmail,onChange:N,required:!0,disabled:g,className:"jsx-96fdb18659252259"})]})]}),(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 form-group",children:[(0,i.jsx)("label",{className:"jsx-96fdb18659252259",children:"수신자 선택"}),(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 recipients-section",children:[(0,i.jsx)("div",{style:{marginBottom:"12px"},className:"jsx-96fdb18659252259",children:(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#333"},className:"jsx-96fdb18659252259",children:[(0,i.jsx)("input",{type:"checkbox",checked:x.recipients.length===f.length&&f.length>0,onChange:e=>z(e.target.checked),disabled:g||j,style:{width:"16px",height:"16px",margin:"0"},className:"jsx-96fdb18659252259"}),(0,i.jsxs)("span",{className:"jsx-96fdb18659252259",children:["전체 선택 (",f.length,"명)"]})]})}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",maxHeight:"240px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",background:"white",padding:"8px"},className:"jsx-96fdb18659252259 recipients-list",children:j?(0,i.jsx)("div",{style:{gridColumn:"1 / -1",padding:"20px",textAlign:"center",color:"#666"},className:"jsx-96fdb18659252259",children:"수신자 목록을 불러오는 중..."}):f.map(e=>(0,i.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"6px",padding:"10px",background:"#f9fafb",fontSize:"13px"},className:"jsx-96fdb18659252259",children:(0,i.jsxs)("label",{style:{display:"flex",alignItems:"flex-start",gap:"8px",cursor:"pointer",margin:"0",padding:"0",width:"100%"},className:"jsx-96fdb18659252259",children:[(0,i.jsx)("input",{type:"checkbox",checked:x.recipients.some(s=>s.id===e.id),onChange:s=>v(e,s.target.checked),disabled:g,style:{width:"16px",height:"16px",margin:"0",marginTop:"2px",flexShrink:"0"},className:"jsx-96fdb18659252259"}),(0,i.jsxs)("div",{style:{flex:"1",minWidth:"0"},className:"jsx-96fdb18659252259",children:[(0,i.jsxs)("div",{style:{marginBottom:"3px"},className:"jsx-96fdb18659252259",children:[(0,i.jsx)("span",{style:{fontWeight:"bold",marginRight:"4px"},className:"jsx-96fdb18659252259",children:e.name}),(0,i.jsxs)("span",{style:{color:"#666"},className:"jsx-96fdb18659252259",children:["(",e.company,")"]})]}),(0,i.jsx)("div",{style:{color:"#888",fontSize:"11px",wordBreak:"break-all"},className:"jsx-96fdb18659252259",children:e.email})]})]})},e.id))}),(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 selected-count",children:["선택된 수신자: ",x.recipients.length,"명"]})]})]})]}),(0,i.jsxs)("div",{className:"jsx-96fdb18659252259 modal-footer",children:[(0,i.jsx)("button",{type:"button",onClick:()=>l(!1),disabled:g,className:"jsx-96fdb18659252259 btn-cancel",children:"취소"}),(0,i.jsx)("button",{type:"submit",disabled:g||0===x.recipients.length,className:"jsx-96fdb18659252259 btn-send-confirm",children:g?"발송 중...":"".concat(x.recipients.length,"명에게 발송")})]})]})]})}),(0,i.jsx)(a(),{id:"96fdb18659252259",children:".modal-overlay.jsx-96fdb18659252259{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;z-index:1000;padding:20px}.modal.jsx-96fdb18659252259{background:white;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;-webkit-box-shadow:0 4px 20px rgba(0,0,0,.15);-moz-box-shadow:0 4px 20px rgba(0,0,0,.15);box-shadow:0 4px 20px rgba(0,0,0,.15)}.modal-header.jsx-96fdb18659252259{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;padding:20px 24px;border-bottom:1px solid#e5e7eb}.modal-header.jsx-96fdb18659252259 h3.jsx-96fdb18659252259{margin:0;font-size:1.25rem;font-weight:600;color:#111827}.btn-close.jsx-96fdb18659252259{background:none;border:none;font-size:24px;cursor:pointer;color:#6b7280;padding:4px;line-height:1}.btn-close.jsx-96fdb18659252259:hover{color:#374151}.modal-body.jsx-96fdb18659252259{padding:24px}.modal-footer.jsx-96fdb18659252259{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-moz-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;gap:12px;padding:20px 24px;border-top:1px solid#e5e7eb;background:#f9fafb}.form-group.jsx-96fdb18659252259{margin-bottom:20px}.form-group.jsx-96fdb18659252259 label.jsx-96fdb18659252259{display:block;margin-bottom:8px;font-weight:500;color:#374151}.form-group.jsx-96fdb18659252259 input.jsx-96fdb18659252259,.form-group.jsx-96fdb18659252259 textarea.jsx-96fdb18659252259{width:100%;padding:8px 10px;border:1px solid#d1d5db;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;font-size:13px;-webkit-transition:border-color.2s;-moz-transition:border-color.2s;-o-transition:border-color.2s;transition:border-color.2s;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.form-group.jsx-96fdb18659252259 input.jsx-96fdb18659252259:focus,.form-group.jsx-96fdb18659252259 textarea.jsx-96fdb18659252259:focus{outline:none;border-color:#3b82f6;-webkit-box-shadow:0 0 0 3px rgba(59,130,246,.1);-moz-box-shadow:0 0 0 3px rgba(59,130,246,.1);box-shadow:0 0 0 3px rgba(59,130,246,.1)}.form-row.jsx-96fdb18659252259{display:grid;grid-template-columns:1fr 1fr;gap:12px}.form-row.jsx-96fdb18659252259 .form-group.jsx-96fdb18659252259{margin-bottom:16px}.recipients-section.jsx-96fdb18659252259{border:1px solid#ddd;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;padding:12px;background:#fafafa}.select-all.jsx-96fdb18659252259{margin-bottom:10px}.select-all.jsx-96fdb18659252259 label.jsx-96fdb18659252259{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:6px;cursor:pointer;font-size:14px}.recipients-list.jsx-96fdb18659252259{max-height:200px;overflow-y:auto;border:1px solid#ddd;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;background:white}.recipient-item.jsx-96fdb18659252259{padding:8px 12px;border-bottom:1px solid#eee}.recipient-item.jsx-96fdb18659252259:last-child{border-bottom:none}.recipient-item.jsx-96fdb18659252259 label.jsx-96fdb18659252259{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;cursor:pointer}.recipient-name.jsx-96fdb18659252259{font-weight:bold;margin-right:4px}.recipient-company.jsx-96fdb18659252259{color:#666;margin-right:8px}.recipient-email.jsx-96fdb18659252259{color:#888;font-size:.9em}.selected-count.jsx-96fdb18659252259{text-align:center;padding:8px;background:#e3f2fd;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;margin-top:10px;font-weight:bold;color:#1976d2}.loading.jsx-96fdb18659252259{text-align:center;padding:20px;color:#666}.btn-send.jsx-96fdb18659252259{background:#10b981;color:white;padding:6px 12px;margin:0 4px;border:none;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;cursor:pointer;font-size:.9em}.btn-send.jsx-96fdb18659252259:hover{background:#059669}.btn-send-confirm.jsx-96fdb18659252259{background:#10b981;color:white;padding:10px 20px;border:none;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;cursor:pointer;font-weight:bold}.btn-send-confirm.jsx-96fdb18659252259:hover:not(:disabled){background:#059669}.btn-send-confirm.jsx-96fdb18659252259:disabled{background:#d1d5db;cursor:not-allowed}.btn-cancel.jsx-96fdb18659252259{background:#6b7280;color:white;padding:10px 20px;border:none;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;cursor:pointer;margin-right:12px}.btn-cancel.jsx-96fdb18659252259:hover:not(:disabled){background:#4b5563}.loading.jsx-96fdb18659252259{text-align:center;padding:20px;color:#666;font-size:12px;grid-column:1/-1}"})]})}}},function(e){e.O(0,[822,888,774,179],function(){return e(e.s=4875)}),_N_E=e.O()}]);