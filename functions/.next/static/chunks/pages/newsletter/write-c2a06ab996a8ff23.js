(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{66:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/newsletter/write",function(){return i(5864)}])},5864:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return c}});var n=i(5893),s=i(7294),r=i(1163),l=i(1664),a=i.n(l);function c(){let e=(0,r.useRouter)(),[t,i]=(0,s.useState)({title:"",content:"",url:"",sentDate:new Date().toISOString().slice(0,10),recipients:[]}),[l,c]=(0,s.useState)(!1),[d,o]=(0,s.useState)(!1),[p,h]=(0,s.useState)([]),[x,m]=(0,s.useState)(!1),[u,j]=(0,s.useState)(!1),f=async i=>{if(i.preventDefault(),!t.title.trim()||!t.content.trim()||!t.sentDate){alert("제목, 내용, 발송일은 필수 항목입니다.");return}if(0===t.recipients.length){alert("수신자를 한 명 이상 선택하세요.");return}c(!0);try{let i=await fetch("/api/newsletter-create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await i.json();if(i.ok)alert("뉴스레터가 성공적으로 생성되었습니다!"),e.push("/newsletter");else throw Error(n.message||"뉴스레터 생성에 실패했습니다.")}catch(t){let e=t instanceof Error?t.message:String(t);alert("오류: ".concat(e))}finally{c(!1)}},g=e=>{let{name:t,value:n}=e.target;i(e=>({...e,[t]:n}))},b=async()=>{m(!0);try{let e=await fetch("/api/newsletter-recipients");if(e.ok){let t=await e.json();h(t.recipients||[])}else console.error("수신자 목록을 불러오지 못했습니다.")}catch(e){console.error("수신자 목록 로드 오류:",e)}finally{m(!1)}},y=e=>{j(e),e?i(e=>({...e,recipients:[...p]})):i(e=>({...e,recipients:[]}))},v=(e,t)=>{t?i(t=>({...t,recipients:[...t.recipients,e]})):i(t=>({...t,recipients:t.recipients.filter(t=>t.id!==e.id)}))};return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)("h1",{children:"뉴스레터 작성"}),(0,n.jsx)(a(),{href:"/newsletter",children:(0,n.jsx)("button",{type:"button",className:"btn-back",children:"목록으로 돌아가기"})})]}),(0,n.jsxs)("form",{onSubmit:f,children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"title",children:"제목 *"}),(0,n.jsx)("input",{type:"text",id:"title",name:"title",value:t.title,onChange:g,required:!0,placeholder:"뉴스레터 제목을 입력하세요"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"content",children:"내용 *"}),(0,n.jsx)("textarea",{id:"content",name:"content",value:t.content,onChange:g,required:!0,rows:10,placeholder:"뉴스레터 내용을 입력하세요"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"url",children:"URL"}),(0,n.jsx)("input",{type:"url",id:"url",name:"url",value:t.url,onChange:g,placeholder:"관련 URL을 입력하세요 (선택사항)"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"sentDate",children:"발송일 *"}),(0,n.jsx)("input",{type:"date",id:"sentDate",name:"sentDate",value:t.sentDate,onChange:g,required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"수신자 선택 *"}),(0,n.jsxs)("div",{className:"recipients-summary",children:[(0,n.jsxs)("div",{className:"recipients-count",children:[(0,n.jsxs)("span",{children:[t.recipients.length,"명 선택됨"]}),(0,n.jsx)("button",{type:"button",className:"btn-select-recipients",onClick:()=>{o(!0),b()},children:"수신자 선택"})]}),t.recipients.length>0&&(0,n.jsxs)("div",{className:"selected-recipients",children:[(0,n.jsx)("h4",{children:"선택된 수신자:"}),(0,n.jsx)("div",{className:"recipients-grid",children:t.recipients.map(e=>(0,n.jsxs)("div",{className:"selected-recipient-item",children:[(0,n.jsxs)("div",{className:"recipient-info",children:[(0,n.jsxs)("div",{className:"recipient-info-line",children:[(0,n.jsx)("span",{className:"recipient-name",children:e.name}),(0,n.jsxs)("span",{className:"recipient-company",children:["(",e.company,")"]})]}),(0,n.jsx)("div",{className:"recipient-info-line",children:(0,n.jsx)("span",{className:"recipient-email",children:e.email})})]}),(0,n.jsx)("button",{type:"button",className:"btn-remove-recipient",onClick:()=>v(e,!1),title:"".concat(e.name," 제거"),children:"\xd7"})]},e.id))})]})]})]}),(0,n.jsx)("div",{className:"form-actions",children:(0,n.jsx)("button",{type:"submit",className:"btn-submit",disabled:l,children:l?"생성 중...":"뉴스레터 생성"})})]}),d&&(0,n.jsx)("div",{className:"modal-overlay",children:(0,n.jsxs)("div",{className:"modal",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h3",{children:"수신자 선택"}),(0,n.jsx)("button",{type:"button",className:"btn-close",onClick:()=>{o(!1)},children:"\xd7"})]}),(0,n.jsxs)("div",{className:"modal-body",children:[(0,n.jsx)("div",{style:{marginBottom:"12px"},children:(0,n.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#333"},children:[(0,n.jsx)("input",{type:"checkbox",checked:u,onChange:e=>y(e.target.checked),style:{width:"16px",height:"16px",margin:"0"}}),(0,n.jsxs)("span",{children:["전체 선택 (",p.length,"명)"]})]})}),(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",maxHeight:"240px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",background:"white",padding:"8px"},children:x?(0,n.jsx)("div",{style:{gridColumn:"1 / -1",padding:"20px",textAlign:"center",color:"#666"},children:"수신자 목록을 불러오는 중..."}):p.map(e=>(0,n.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"6px",padding:"10px",background:"#f9fafb",fontSize:"13px"},children:(0,n.jsxs)("label",{style:{display:"flex",alignItems:"flex-start",gap:"8px",cursor:"pointer",margin:"0",padding:"0",width:"100%"},children:[(0,n.jsx)("input",{type:"checkbox",checked:t.recipients.some(t=>t.id===e.id),onChange:t=>v(e,t.target.checked),style:{width:"16px",height:"16px",margin:"0",marginTop:"2px",flexShrink:"0"}}),(0,n.jsxs)("div",{style:{flex:"1",minWidth:"0"},children:[(0,n.jsxs)("div",{style:{marginBottom:"3px"},children:[(0,n.jsx)("span",{style:{fontWeight:"bold",marginRight:"4px"},children:e.name}),(0,n.jsxs)("span",{style:{color:"#666"},children:["(",e.company,")"]})]}),(0,n.jsx)("div",{style:{color:"#888",fontSize:"11px",wordBreak:"break-all"},children:e.email})]})]})},e.id))})]}),(0,n.jsx)("div",{className:"modal-footer",children:(0,n.jsx)("button",{type:"button",className:"btn-confirm",onClick:()=>{o(!1)},children:"확인"})})]})})]})}},1163:function(e,t,i){e.exports=i(9090)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=66)}),_N_E=e.O()}]);