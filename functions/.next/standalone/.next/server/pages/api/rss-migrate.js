"use strict";(()=>{var e={};e.id=801,e.ids=[801],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3745:e=>{e.exports=import("firebase/app")},1492:e=>{e.exports=import("firebase/firestore")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7270:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>g,default:()=>c,routeModule:()=>u});var s=r(1802),a=r(7153),i=r(6249),l=r(5213),n=e([l]);l=(n.then?(await n)():n)[0];let c=(0,i.l)(l,"default"),g=(0,i.l)(l,"config"),u=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/rss-migrate",pathname:"/api/rss-migrate",bundlePath:"",filename:""},userland:l});o()}catch(e){o(e)}})},4810:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{db:()=>c});var s=r(3745),a=r(1492),i=e([s,a]);[s,a]=i.then?(await i)():i;let l={apiKey:"AIzaSyA6kCmSqaBH5SUPb4PkHU1hwe0l5Ppqw2w",authDomain:"logbase-blog-83db6.firebaseapp.com",projectId:"logbase-blog-83db6",storageBucket:"logbase-blog-83db6.firebasestorage.app",messagingSenderId:"938632982963",appId:"1:938632982963:web:6159f776e4466bf74bdbc6"};console.log("\uD83D\uDD25 Firebase 설정 확인:",{projectId:l.projectId,apiKey:l.apiKey?.substring(0,10)+"...",authDomain:l.authDomain,hasApiKey:!!l.apiKey,hasProjectId:!!l.projectId});let n=0===(0,s.getApps)().length?(0,s.initializeApp)(l):(0,s.getApps)()[0],c=(0,a.getFirestore)(n);o()}catch(e){o(e)}})},531:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{Y:()=>u});var s=r(1492),a=r(4810),i=r(7147),l=r.n(i),n=r(1017),c=r.n(n),g=e([s,a]);[s,a]=g.then?(await g)():g;class u{constructor(e="../logbase-blog-astro/public/rss"){this.rssDirectory=e}async parseRSSFiles(){try{let e=await this.getRSSFiles(),t=[];for(let r of e)try{let e=c().join(this.rssDirectory,r),o=l().readFileSync(e,"utf-8"),s=JSON.parse(o),a=c().basename(r,".json").match(/(\d{8})/);a&&(s.collectedDate=a[1]),t.push(s)}catch(e){console.error(`Error parsing file ${r}:`,e)}return t}catch(e){throw console.error("Error parsing RSS files:",e),e}}async getRSSFiles(){try{return l().readdirSync(this.rssDirectory).filter(e=>e.endsWith(".json"))}catch(e){return console.error("Error reading RSS directory:",e),[]}}async saveToFirestore(e){try{console.log("\uD83D\uDD25 Firestore 연결 테스트 중...");let t=(0,s.collection)(a.db,"rss_items"),r=(0,s.query)(t,(0,s.limit)(1));try{await (0,s.getDocs)(r),console.log("✅ Firestore 연결 성공")}catch(e){throw console.error("❌ Firestore 연결 실패:",e),Error(`Firestore 연결 실패: ${e}`)}let o=0,i=0,l=0;console.log(`📝 ${e.length}개 아이템 저장 시작...`);for(let r=0;r<e.length;r++){let n=e[r];console.log(`🔄 처리 중 (${r+1}/${e.length}): ${n.blogName} - ${n.title?.substring(0,30)}...`);try{let e={title:n.title?.substring(0,1e3)||"",link:n.link?.substring(0,500)||"",pubDate:n.pubDate?.substring(0,100)||"",description:n.description?.substring(0,2e3)||"",guid:n.guid?.substring(0,500)||"",isoDate:n.isoDate?.substring(0,100)||"",blogName:n.blogName?.substring(0,100)||"",feedType:n.feedType||"noncompetitor",matchedKeywords:Array.isArray(n.matchedKeywords)?n.matchedKeywords.slice(0,10).map(e=>e.substring(0,100)):[],collectedDate:n.collectedDate?.substring(0,20)||"",createdAt:new Date,updatedAt:new Date};console.log(`📋 데이터 준비 완료: ${n.blogName}`);let r=(0,s.query)(t,(0,s.where)("guid","==",n.guid));console.log(`🔍 중복 체크 중: ${n.guid}`);let l=await (0,s.getDocs)(r);if(l.empty)console.log(`💾 새 문서 저장 중: ${n.blogName}`),await (0,s.addDoc)(t,e),o++,console.log(`✅ 저장됨: ${n.blogName} - ${n.title?.substring(0,50)}...`);else{console.log(`🔄 기존 문서 업데이트 중: ${n.blogName}`);let t=(0,s.doc)(a.db,"rss_items",l.docs[0].id);await (0,s.updateDoc)(t,{...e,updatedAt:new Date}),i++,console.log(`⏭️ 건너뜀: ${n.blogName} - ${n.title?.substring(0,50)}...`)}}catch(t){console.error(`❌ 에러 발생: ${n.blogName} - ${n.guid}`,t),l++;let e=t instanceof Error?t.message:String(t);throw Error(`RSS 저장 중 에러 발생: ${n.blogName} - ${n.guid} - ${e}`)}await new Promise(e=>setTimeout(e,200))}console.log(`🎉 RSS 저장 완료: ${o}개 새로 저장, ${i}개 업데이트, ${l}개 에러`)}catch(e){throw console.error("\uD83D\uDCA5 Error saving to Firestore:",e),e}}sanitizeForFirestore(e){let t={};for(let[r,o]of Object.entries(e))if(null!=o){if("string"==typeof o&&o.length>1e6)t[r]=o.substring(0,1e6)+"... [truncated]";else if("isoDate"===r&&"string"==typeof o)try{t[r]=new Date(o)}catch{t[r]=o}else Array.isArray(o)?t[r]=o.map(e=>"string"==typeof e&&e.length>1e3?e.substring(0,1e3):e):t[r]=o}return t}async getFromFirestore(e=50){try{let t=(0,s.collection)(a.db,"rss_items"),r=(0,s.query)(t,(0,s.orderBy)("isoDate","desc"),(0,s.limit)(e)),o=await (0,s.getDocs)(r),i=[];return o.forEach(e=>{i.push(e.data())}),i}catch(e){throw console.error("Error getting from Firestore:",e),e}}async getByBlogName(e,t=20){try{let r=(0,s.collection)(a.db,"rss_items"),o=(0,s.query)(r,(0,s.where)("blogName","==",e),(0,s.orderBy)("isoDate","desc"),(0,s.limit)(t)),i=await (0,s.getDocs)(o),l=[];return i.forEach(e=>{l.push(e.data())}),l}catch(e){throw console.error("Error getting by blog name:",e),e}}async migrateAllRSSData(){try{console.log("RSS 데이터 마이그레이션 시작...");let e=await this.parseRSSFiles();console.log(`총 ${e.length}개의 RSS 아이템을 파싱했습니다.`),await this.saveToFirestore(e),console.log("RSS 데이터 마이그레이션 완료!")}catch(e){throw console.error("RSS 데이터 마이그레이션 실패:",e),e}}}o()}catch(e){o(e)}})},5213:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>n});var s=r(531),a=r(4810),i=r(1492),l=e([s,a,i]);async function n(e,t){if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),"OPTIONS"===e.method){t.status(200).end();return}if("POST"===e.method)try{let e=new s.Y;await e.migrateAllRSSData(),t.status(200).json({success:!0,message:"RSS 데이터 마이그레이션이 완료되었습니다."})}catch(e){console.error("RSS 마이그레이션 에러:",e),t.status(500).json({success:!1,error:"RSS 데이터 마이그레이션 중 오류가 발생했습니다."})}else if("GET"===e.method)try{let{blogName:r,pageSize:o="10",feedType:s,searchText:l="",page:n="1"}=e.query,c=parseInt(o),g=parseInt(n),u=l.toLowerCase(),d=(0,i.collection)(a.db,"rss_items"),h=[],p=0,y=0,b=(0,i.query)(d,(0,i.orderBy)("isoDate","desc"));r&&"all"!==r&&(b=(0,i.query)(d,(0,i.where)("blogName","==",r),(0,i.orderBy)("isoDate","desc"))),s&&"all"!==s&&(b=r&&"all"!==r?(0,i.query)(d,(0,i.where)("blogName","==",r),(0,i.where)("feedType","==",s),(0,i.orderBy)("isoDate","desc")):(0,i.query)(d,(0,i.where)("feedType","==",s),(0,i.orderBy)("isoDate","desc"))),console.log("\uD83D\uDD0D 쿼리 조건:",{blogName:r,feedType:s,searchText:l,page:n,pageSize:o});let m=(await (0,i.getDocs)(b)).docs.map(e=>e.data());console.log("\uD83D\uDCCA 전체 데이터 수:",m.length),u&&(m=m.filter(e=>e.blogName&&e.blogName.toLowerCase().includes(u)||e.title&&e.title.toLowerCase().includes(u)||e.description&&e.description.toLowerCase().includes(u)),console.log("\uD83D\uDD0D 검색 필터 후 데이터 수:",m.length)),y=m.length;let D=(g-1)*c,S=D+c;h=m.slice(D,S),console.log("\uD83D\uDCC4 페이지네이션:",{page:g,pageSize:c,startIdx:D,endIdx:S,resultCount:h.length,filteredCount:y}),p=(await (0,i.getCountFromServer)(d)).data().count;let f=h.length>0?h[h.length-1].isoDate:null;t.status(200).json({success:!0,data:h,count:h.length,totalCount:p,filteredCount:y,lastIsoDate:f,currentPage:g,totalPages:Math.ceil(y/c)})}catch(e){console.error("RSS 조회 에러:",e),t.status(500).json({success:!1,error:"RSS 데이터 조회 중 오류가 발생했습니다."})}else t.setHeader("Allow",["GET","POST"]),t.status(405).end(`Method ${e.method} Not Allowed`)}[s,a,i]=l.then?(await l)():l,o()}catch(e){o(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=7270);module.exports=r})();