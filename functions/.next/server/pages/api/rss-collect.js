"use strict";(()=>{var e={};e.id=756,e.ids=[756],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3309:e=>{e.exports=require("rss-parser")},3745:e=>{e.exports=import("firebase/app")},1492:e=>{e.exports=import("firebase/firestore")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},7133:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{config:()=>p,default:()=>c,routeModule:()=>d});var s=a(1802),r=a(7153),l=a(6249),n=a(6097),i=e([n]);n=(i.then?(await i)():i)[0];let c=(0,l.l)(n,"default"),p=(0,l.l)(n,"config"),d=new s.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/rss-collect",pathname:"/api/rss-collect",bundlePath:"",filename:""},userland:n});o()}catch(e){o(e)}})},4810:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.d(t,{db:()=>c});var s=a(3745),r=a(1492),l=e([s,r]);[s,r]=l.then?(await l)():l;let n={apiKey:"AIzaSyA6kCmSqaBH5SUPb4PkHU1hwe0l5Ppqw2w",authDomain:"logbase-blog-83db6.firebaseapp.com",projectId:"logbase-blog-83db6",storageBucket:"logbase-blog-83db6.firebasestorage.app",messagingSenderId:"938632982963",appId:"1:938632982963:web:6159f776e4466bf74bdbc6"};console.log("\uD83D\uDD25 Firebase 설정 확인:",{projectId:n.projectId,apiKey:n.apiKey?.substring(0,10)+"...",authDomain:n.authDomain,hasApiKey:!!n.apiKey,hasProjectId:!!n.projectId});let i=0===(0,s.getApps)().length?(0,s.initializeApp)(n):(0,s.getApps)()[0],c=(0,r.getFirestore)(i);o()}catch(e){o(e)}})},6097:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{default:()=>u});var s=a(3309),r=a.n(s),l=a(4810),n=a(1492),i=a(1017),c=a.n(i),p=a(3292),d=a.n(p),m=e([l,n]);[l,n]=m.then?(await m)():m;let g=new(r())({customFields:{item:["content:encoded","description","summary"]},headers:{"User-Agent":"Mozilla/5.0 (compatible; RSSReader/1.0)"},timeout:1e4}),h=[];try{let e=c().resolve(process.cwd(),"public/feeds.json"),t=await d().readFile(e,"utf-8");h=JSON.parse(t),console.log("[rss-collect] public/feeds.json에서 피드 로드:",h.length,"개")}catch(e){console.log("[rss-collect] 피드 로드 오류:",e),h=[{name:"avohq",url:"https://avohq.io/blog/rss",type:"competitor",status:"active"},{name:"segment",url:"https://segment.com/blog/feed.xml",type:"competitor",status:"active"},{name:"openai",url:"https://openai.com/blog/rss.xml",type:"competitor",status:"active"},{name:"pendo",url:"https://www.pendo.io/pendo-blog/feed",type:"competitor",status:"active"},{name:"mixpanel",url:"https://mixpanel.com/blog/feed",type:"competitor",status:"error"},{name:"databricks",url:"https://www.databricks.com/rss.xml",type:"competitor",status:"active"},{name:"freshpaint",url:"https://rss.app/feeds/0S6b7vLWnGFO3Pbs.xml",type:"competitor",status:"active"},{name:"amplitude",url:"https://rss.app/feeds/Ma06vfcA9qgJA3dZ.xml",type:"competitor",status:"active"},{name:"heap",url:"https://rss.app/feeds/E41H3hZEVRkAB2Xb.xml",type:"competitor",status:"active"},{name:"zeotap",url:"https://rss.app/feeds/YPWdGDZ9EeBq67VJ.xml",type:"competitor",status:"active"},{name:"avo",url:"https://rss.app/feeds/6rBLKkjuHbjxPNub.xml",type:"competitor",status:"active"},{name:"posthog",url:"https://rss.app/feeds/zfIOyXjRZwkRaEzE.xml",type:"competitor",status:"active"},{name:"logrocket",url:"https://blog.logrocket.com/feed/",type:"noncompetitor",status:"active"},{name:"otel_collector",url:"https://github.com/open-telemetry/opentelemetry-collector/releases.atom",type:"noncompetitor",status:"active"},{name:"montecarlo",url:"https://www.montecarlodata.com/feed/",type:"noncompetitor",status:"active"},{name:"montecarlo_product",url:"https://www.montecarlodata.com/category/product/feed/",type:"noncompetitor",status:"active"},{name:"towardsdatascience",url:"https://towardsdatascience.com/feed",type:"noncompetitor",status:"active"},{name:"aws_bigdata",url:"https://aws.amazon.com/blogs/big-data/feed/",type:"noncompetitor",status:"active"},{name:"snowplow",url:"https://rss.app/feeds/xxSHa2H0VG127Q4h.xml",type:"noncompetitor",status:"active"},{name:"logrocket_frontend",url:"https://rss.app/feeds/OQnZqgiK7aZqIv4B.xml",type:"noncompetitor",status:"active"},{name:"towardsdatascience_analytics",url:"https://rss.app/feeds/jHv0SqVEQUa18Eln.xml",type:"noncompetitor",status:"active"}],console.log("[rss-collect] 기본 하드코딩 피드 사용")}let y=[];try{let e=c().resolve(process.cwd(),"public/keywords.json"),t=await d().readFile(e,"utf-8");y=JSON.parse(t),console.log("[rss-collect] public/keywords.json에서 키워드 로드:",y.length,"개")}catch(e){console.log("[rss-collect] 키워드 로드 오류:",e),y=["behavioral data","event log","event data","analytics data","observability","log validation","log enrichment","user journey data","journey data","journey log","journey tracking","mobile tracking","no code tracking","user event stream","behavioral analytics","event instrumentation","AI behavior modeling","predictive behavior analytics","user journey AI","customer behavior AI","data observability","data contract validation","automated logging","analytics event QA","data reliability","A/B test","data metric","Analytics","product analytics","Machine learning in Analytics","LLM in analytics","Behavioral Segmentation"],console.log("[rss-collect] 기본 하드코딩 키워드 사용")}async function u(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let a=new Date;console.log(`🚀 RSS 피드 수집 시작: ${a.toLocaleString("ko-KR")}`);let o=[],s=0,r=0;for(let e of h){if("error"===e.status){console.log(`⏭️ 건너뛰기: ${e.name} (에러 상태, ${e.type})`);continue}try{let t=await fetch(e.url),a=await t.text();a=(a=a.replace(/&(?!amp;|lt;|gt;|quot;|apos;|#\d+;|#x[a-fA-F0-9]+;)/g,"&amp;")).replace(/&(?![a-zA-Z0-9#]+;)/g,"&amp;");let r=await g.parseString(a);r.items.forEach(t=>{t.blogName=e.name,t.feedType=e.type}),o=o.concat(r.items),s++,console.log(`✅ RSS 파싱 성공: ${e.name} (${r.items.length}개 글, ${e.type})`)}catch(t){console.error(`❌ RSS 파싱 에러: ${e.name} (${e.type}) - ${e.url}`,t),r++}await new Promise(e=>setTimeout(e,200))}let i=o.filter(e=>"competitor"===e.feedType),c=o.filter(e=>"noncompetitor"===e.feedType);i.forEach(e=>{let t=(e.title+" "+(e.content||"")+" "+(e.summary||"")).toLowerCase(),a=y.filter(e=>t.includes(e.toLowerCase()));e.matchedKeywords=a});let p=c.map(e=>{let t=(e.title+" "+(e.content||"")+" "+(e.summary||"")).toLowerCase(),a=y.filter(e=>t.includes(e.toLowerCase()));return e.matchedKeywords=a,e}).filter(e=>e.matchedKeywords.length>0),d=[...i,...p],m=new Date;m.getFullYear(),m.getMonth(),m.getDate();let u=new Date(m.getFullYear(),m.getMonth(),m.getDate()-1,0,0,0,0),f=new Date(m.getFullYear(),m.getMonth(),m.getDate()-1,23,59,59,999),b=(0,n.collection)(l.db,"rss_items"),w=new Date().toISOString().slice(0,10),v=0,A=new Set;try{let e=(0,n.query)(b,(0,n.where)("collectedDate","==",w)),t=await (0,n.getDocs)(e);v=t.size,t.docs.forEach(e=>{let t=e.data(),a=`${t.title}_${t.blogName}`;A.add(a)}),console.log(`[rss-collect] 오늘(${w}) 수집된 문서 개수:`,v),console.log(`[rss-collect] 중복 체크용 키 개수:`,A.size)}catch(e){console.log("[rss-collect] 오늘 데이터 조회 오류:",e)}let S=d.filter(e=>{if(!e.pubDate)return!1;let t=new Date(e.pubDate);return t>=u&&t<=f}).sort((e,t)=>new Date(t.pubDate).getTime()-new Date(e.pubDate).getTime());console.log(`📊 전체 ${o.length}개 글 중 경쟁사 ${i.length}개, 비경쟁사 키워드 필터링 후 ${p.length}개, 총 ${d.length}개, 어제 날짜 필터링 후 ${S.length}개`);let D=0,P=0;for(let e of S){try{let t=`${e.title}_${e.blogName}`;if(A.has(t)){P++;continue}let a={...e,createdAt:new Date,updatedAt:new Date,collectedDate:w,news_letter_sent_date:null};await (0,n.addDoc)(b,a),D++,A.add(t),D%10==0&&console.log(`[rss-collect] ${D}개 문서 저장 완료`)}catch(e){D%10==0&&console.error("❌ Firestore 저장 에러:",e)}D%5==0&&await new Promise(e=>setTimeout(e,100))}let x={totalFeeds:h.filter(e=>"active"===e.status).length,successfulFeeds:s,failedFeeds:r,totalArticles:o.length,competitorArticles:i.length,nonCompetitorFilteredArticles:p.length,totalFilteredArticles:d.length,savedArticles:D,skippedArticles:P,filteredByDateArticles:S.length,message:D>0?`RSS 최신글 ${D}개가 Firestore에 저장되었습니다! (중복 제외: ${P}개, 경쟁사: 키워드 필터 없음, 비경쟁사: 키워드 필터 적용)`:`키워드에 맞는 글이 없습니다. (전체 ${o.length}개 글 중 경쟁사 ${i.length}개, 비경쟁사 필터링 ${p.length}개)`},$=new Date,j=$.getTime()-a.getTime(),k=Math.round(j/1e3);console.log(`🏁 RSS 피드 수집 완료: ${$.toLocaleString("ko-KR")}`),console.log(`⏱️ 총 소요 시간: ${k}초 (${Math.round(j)}ms)`),console.log("\uD83D\uDCCB 최종 결과:",x);let I={...x,startTime:a.toISOString(),endTime:$.toISOString(),durationSeconds:k,durationMs:j};t.status(200).json(I)}o()}catch(e){o(e)}},1)},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=7133);module.exports=a})();